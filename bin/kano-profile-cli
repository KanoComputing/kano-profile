#!/usr/bin/env python

# Copyright (C) 2014 Kano Computing Ltd.
# License: http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
#

import os
import sys
if __name__ == '__main__' and __package__ is None:
    dir_path = os.path.abspath(os.path.join(os.path.dirname(__file__), '..'))
    if dir_path != '/usr':
        sys.path.insert(1, dir_path)

from kano.profile.apps import get_app_data_dir, load_app_state_variable
from kano.profile.profile import set_unlocked
from kano.profile.badges import save_app_state_variable_with_dialog, calculate_xp, \
    calculate_kano_level, increment_app_state_variable_with_dialog
from kano.world.functions import is_registered, get_mixed_username
from kano.utils import is_number

variable_not_found_str = "VARIABLE_NOT_FOUND"


def check_arg_len(number):
    if len(sys.argv) != number + 1:
        print 'Command entered was {}'.format(sys.argv)
        sys.exit("Wrong usage, need {} arguments".format(number))


if __name__ != '__main__':
    sys.exit("This is a script, do not import it as a module!")

if len(sys.argv) == 1:
    sys.exit("Wrong usage, needs an argument")

if sys.argv[1] == 'get_app_data_dir':
    check_arg_len(2)
    app_name = sys.argv[2]
    sys.stdout.write(get_app_data_dir(app_name))

elif sys.argv[1] == 'load_app_state_variable':
    check_arg_len(3)
    app_name = sys.argv[2]
    variable = sys.argv[3]
    value = load_app_state_variable(app_name, variable)
    if value:
        sys.stdout.write(str(value))
    else:
        sys.stdout.write(variable_not_found_str)

elif sys.argv[1] == 'save_app_state_variable':
    check_arg_len(4)
    app_name = sys.argv[2]
    variable = sys.argv[3]
    value = sys.argv[4]
    if value.isdigit():
        value = int(value)
    elif is_number(value):
        value = float(value)
    save_app_state_variable_with_dialog(app_name, variable, value)

elif sys.argv[1] == 'increment_app_state_variable':
    check_arg_len(4)
    app_name = sys.argv[2]
    variable = sys.argv[3]
    value = sys.argv[4]
    if value.isdigit():
        value = int(value)
    elif is_number(value):
        value = float(value)
    increment_app_state_variable_with_dialog(app_name, variable, value)

elif sys.argv[1] == 'unlock':
    check_arg_len(1)
    set_unlocked(True)

elif sys.argv[1] == 'lock':
    check_arg_len(1)
    set_unlocked(False)

elif sys.argv[1] == 'is_registered':
    check_arg_len(1)
    print int(is_registered())

elif sys.argv[1] == 'get_avatar':
    check_arg_len(1)
    print 'judoka judoka_1'

elif sys.argv[1] == 'get_xp':
    check_arg_len(1)
    print calculate_xp()

elif sys.argv[1] == 'get_level':
    check_arg_len(1)
    level, progress = calculate_kano_level()
    print level

elif sys.argv[1] == 'get_username':
    check_arg_len(1)
    print get_mixed_username()

else:
    sys.exit("wrong usage")
