#!/usr/bin/env python

# kano-login-dialog.py
#
# Copyright (C) 2014 Kano Computing Ltd.
# License: http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
#
# UI for login screen

import os
import sys

if __name__ == '__main__' and __package__ is None:
    dir_path = os.path.abspath(os.path.join(os.path.dirname(__file__), '..'))
    if dir_path != '/usr':
        sys.path.insert(1, dir_path)

from kano.world.functions import login_using_token, login, register, remove_token

if len(sys.argv) == 2:
    if sys.argv[1] == '--reset':
        remove_token()


def check_login():
    success, _ = login_using_token()
    if success:
        print "Login OK"
        sys.exit()


def main():
    check_login()

    choice = raw_input('Login (L) or Register (R)?: ').lower()

    if choice == 'l':
        email = raw_input('e-mail: ')
        password = raw_input('password: ')
        success, error = login(email, password)
        if not success:
            sys.exit('Error with login: {}'.format(error))
        check_login()

    if choice == 'r':
        email = raw_input('e-mail: ')
        username = raw_input('username: ')
        password = raw_input('password: ')
        success, error = register(email, username, password)
        if not success:
            sys.exit('Error with registering: {}'.format(error))
        sys.exit()


if __name__ == '__main__':
    main()
