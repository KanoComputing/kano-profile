#!/usr/bin/env python

# kano-share
#
# Copyright (C) 2014 Kano Computing Ltd.
# License: http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
#
# UI for share screen

import os
import sys

if __name__ == '__main__' and __package__ is None:
    dir_path = os.path.abspath(os.path.join(os.path.dirname(__file__), '..'))
    if dir_path != '/usr':
        sys.path.insert(1, dir_path)

from kano.network import is_internet
from kano.utils import run_cmd
from kano.logging import logger
from kano_world.share import download_share, get_share_by_id
from kano_profile.apps import launch_project

if not is_internet():
    sys.exit('no internet')

if not len(sys.argv) == 2:
    sys.exit('need an argument for id')

share_id = sys.argv[1]

success, text, share = get_share_by_id(share_id)
if not success:
    msg = 'Error downloading share: {}'.format(text)
    logger.error(msg)
    sys.exit(msg)

success, data = download_share(share)
if not success:
    msg = 'Could not download share, error: {}'.format(data)
    logger.error(msg)
    sys.exit(msg)

(title, attachment_path, app, attachment_name, folder) = data
msg = 'Downloaded share: {}'.format(title)
logger.info(msg)

cmd = 'kano-dialog title="Download completed successfully" buttons=Launch:green:1,Return:grey:2'
_, _, rc = run_cmd(cmd)
if rc == 1:
    launch_project(app, attachment_name, folder)
