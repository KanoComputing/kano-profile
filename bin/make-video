#!/bin/sh

# make-video
#
# Copyright (C) 2014 Kano Computing Ltd.
# License: http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
#

linebreak()
{
   echo -n "\n"
}

echo_header()
{
   echo "   _____          __            ____   ____.__    .___"
   echo "  /     \  ____  |  | __ ____   \   \ /   /|__| __| _/____  ____"
   echo " /  \ /  \ \_  \ |  |/ // __ \   \   Y   / |  |/ __ |/ __ \/  _ \ "
   echo "/    Y    \ /__ \|    <\  ___/    \     /  |  / /_/ \  ___(  <_> )"
   echo "\____|__  (____  /__|_ \\___  >     \___/   |__\ ___ |\ __  >____/"
   echo "        \/     \/     \/    \/                     \/    \/"
   linebreak
}

check_internet()
{
   ping -qc 1 8.8.8.8 > /dev/null 2>&1
   return $?
}



# Disable Ctrl+C and Ctrl+D
stty intr undef
stty eof '?'

clear
echo_header
sleep 1

# Check internet connection
typewriter_echo "Checking internet connection"
check_internet
INTERNET=$?
if [ $INTERNET != 0 ]; then
   # WiFi config
   typewriter_echo "You are not connected, let's fix that!"
   sudo /usr/bin/kano-wifi
   clear
   echo_header
   # Check internet connection again
   check_internet
   INTERNET=$?
fi

# level 1

# Youtube exercise
clear
echo_header
if [ $INTERNET = 0 ]; then
   typewriter_echo "I can show you more than just words."
   typewriter_echo "Let's get a video, type youtube:"  0 2
else
   typewriter_echo "Don't worry, even without internet I can show you a video."
   typewriter_echo "Let's get it, type youtube:"  0 2
fi

while true; do
    read -r command
    if [ -z "$command" ]; then
        typewriter_echo "You need to enter a command."
    elif [ "$command" = "exit" ]; then
        exit 0
    elif [ ! "$command" = "youtube" ]; then
        typewriter_echo "Not the correct command, try again."
    else
        if [ $INTERNET = 0 ]; then
            /usr/bin/youtube

            clear
            echo_header
            typewriter_echo "Brilliant! You have completed Make Video!"

            # level gets 2
       else
            /usr/bin/youtube -n

            clear
            echo_header
            typewriter_echo "Great! Come back again with internet connection to complete the Level"

            # level stays 1
       fi
       break
    fi
done

sleep 1
